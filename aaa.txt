(
	/*
	-- Duplicate hierarchical object as reference
	fn ReferenceHierarchy obj parentNode:undefined =
	(
		-- 1. Create reference
		local newObj = reference obj
		newObj.name = "ref_" + newObj.name
		
		-- 2. Set parent if specified
		if parentNode != undefined do
			newObj.parent = parentNode
		
		-- 3. Process all children
		for child in obj.children do
		(
			ReferenceHierarchy child parentNode:newObj
		)
		
		return newObj
	)
*/

	-- 実行部分
	if selection.count > 0 then
	(
		undo "Reference Hierarchy" on
		(
			-- 選択されたトップノードから開始
			MyUtil.ReferenceHierarchy selection[1]
		)
	)
	else
	(
		messageBox "オブジェクトを選択してください。"
	)
)